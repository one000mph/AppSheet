extends ../node_modules/jade-bootstrap/_bootstrap
append styles
	- // Custom styles for this template
	link(href='../sticky-footer-navbar.css', rel='stylesheet')
	link(href='../custom.css', rel='stylesheet')
	title Appsheet Programming Challenge

append scripts
	script(src="//code.jquery.com/jquery-1.11.3.min.js")
	script(src="//cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.js")
	script(src="//rawgit.com/ssorallen/jquery-scrollstop/master/jquery.scrollstop.js")
	script(src="//cdnjs.cloudflare.com/ajax/libs/jade/1.11.0/runtime.js")
	script(src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js")
	script(src="../jade-templates.js")
	script.

		String.prototype.capitalizeFirstLetter = function() {
			return this.charAt(0).toUpperCase() + this.slice(1);
		}

		var boldHeader = function boldHeader (header, val) {
			return "<b>" + header + "</b>: " + val + "<br>";
		};

		var deCamelUnderscore = function deCamelUnderscore (val) {
			return val.replace(/([A-Z])/g, ' $1') // add spaces, replace underscores
					  .replace(/([_])/g, ' ')
					  .replace(/^./, function(str){ return str.toUpperCase(); }) // capitalize first char
		};

		var retrieveUrl = function retrieveUrl (id, elClass, callback) {
			$.getJSON('https://appsheettest1.azurewebsites.net/sample/art/' + id, 
			function (data) {
				var url = data.thumbnailUrl;
				var formattedData = "";
				// remove non-essential meta data
				var displayData = _.omit(data, ['thumbnailUrl',
												'id',
												'mm',
												'thumbnailCopyright',
												'artistId',
												'width',
												'height',
												'units',
												'depth',
												'dateText',
												'artistRole',
												'inscription']);
				// format the meta data
				var artAccessionNum, artist, artTitle, artMedium, artCredit,
				artYear, artAcquisition, artDims, artUrl;
				$.each(displayData, function (key, val) {
					key = deCamelUnderscore(key);
					key = key.capitalizeFirstLetter();
					console.log(key);
					switch(key) {
						case 'Accession number':
							artAccessionNum = boldHeader(key, val);
							break;
						case 'Artist':
							artist = boldHeader(key, val);
							break;
						case 'Title':
							artTitle = boldHeader(key, val);
							break;
						case 'Medium':
							artMedium = boldHeader(key, val);
							break;
						case 'Credit Line':
							artCredit = boldHeader(key, val);
							break;
						case 'Year':
							artYear = boldHeader(key, val);
							break;
						case 'Acquisition Year':
							artAcquisition = boldHeader(key, val);
							break;
						case 'Dimensions':
							artDims = boldHeader(key, val);
							break;
						case 'Url':
							artUrl = "<b>" + key + "</b>: <a href=\'" + val + "\'>View Image On Original Site</a><br>";
							console.log("URL", artUrl);
							break;
						default:
							console.log("default");
					}
				});
				formattedData = formattedData.concat(artTitle,
														 artist,
														 artMedium,
														 artYear,
														 artAcquisition,
														 artDims,
														 artAccessionNum,
														 artCredit,
														 artUrl);
				console.log(formattedData);
				$('div.meta'+id).append("<p>" + formattedData + "</p>");
				// adding url to image element
				$(elClass).attr('data-original', url).css("padding", "10px");
				// callback to load image
				callback();
			});
		};

		var showHideDiv = function showHideDiv(elId) {
			var sliderEl = "div." + elId;
			if ($(sliderEl).hasClass("open")) {
				$(sliderEl).slideUp(300).removeClass("open");
			} else {
				$(sliderEl).slideDown(300).addClass("open");
			}
		};

		var loadImage = function loadImage (id) {
			retrieveUrl(id, '.lazy'+id, function () {
				$('img.lazy'+id).show().lazyload({
					event: "scrollstop",
					effect: "fadeIn",
					threshold : 500
				});
			});
		};

		var loadImages = function loadImages () {
			var toLoad = idsArr.slice(imageIndex,imageIndex+30);
			if (toLoad.length > 0) {
				$('div.images').append(genColumns({ids: toLoad}));
				$.each(toLoad, function (i, id) {
					loadImage(id);
				});
				imageIndex += 30;
			}
		};

		// Called Methods

		var imageIndex = 0;
		//- var imgCount = 30;

		var idsArr = '#{ids}'.split(',');
		var idsCount = idsArr.length;


		$(function () {
			loadImages();
			$('#load').click(function (event) {
				event.preventDefault();
				loadImages();
			})
		})
		

		


block body
	- // Fixed navbar
	nav.navbar.navbar-default.navbar-fixed-top
		.container
			.navbar-header
				button.navbar-toggle.collapsed(type='button', data-toggle='collapse', data-target='#navbar', aria-expanded='false', aria-controls='navbar')
					span.sr-only Toggle navigation
					span.icon-bar
					span.icon-bar
					span.icon-bar
				a.navbar-brand(href='#') AppSheet
	.container
		.page-header
			h1 Art Gallery
			p.lead
				| Click images for meta data
		div.images
			- // images will be dynamically loaded here

		a(href="#", id="load") More Images ...

